class u extends HTMLElement{tocEl=null;visibleClass="visible";observer;anchorNavTarget=null;headingIdxMap=new Map;headings=[];sections=[];tocEntries=[];active=[];scrollCorrectionTimers=[];resizeObserver=null;scrollAnimationId=0;activeIndicator=null;updatePending=!1;prevActiveMin=-1;prevActiveMax=-1;activeCount=0;constructor(){super(),this.observer=new IntersectionObserver(this.markVisibleSection,{threshold:0})}markVisibleSection=t=>{t.forEach(e=>{const i=e.target.children[0]?.getAttribute("id"),s=i?this.headingIdxMap.get(i):void 0;if(s!=null){const o=this.active[s],n=e.isIntersecting;o!==n&&(this.active[s]=n,this.activeCount+=n?1:-1)}e.isIntersecting&&this.anchorNavTarget==e.target.firstChild&&(this.anchorNavTarget=null)}),this.activeCount<=0&&this.fallback(),this.update()};toggleActiveHeading=()=>{let t=this.active.length-1,e=this.active.length-1,i=-1;for(;t>=0&&!this.active[t];)t--;for(;t>=0&&this.active[t];)e=Math.min(e,t),i=Math.max(i,t),t--;if(e===this.prevActiveMin&&i===this.prevActiveMax)return!1;this.prevActiveMin=e,this.prevActiveMax=i;for(let s=0;s<this.tocEntries.length;s++)s>=e&&s<=i?this.tocEntries[s].classList.add(this.visibleClass):this.tocEntries[s].classList.remove(this.visibleClass);if(e>i)this.activeIndicator?.setAttribute("style","opacity: 0");else{let s=this.tocEl?.getBoundingClientRect().top||0,o=this.tocEl?.scrollTop||0,n=this.tocEntries[e].getBoundingClientRect().top-s+o,r=this.tocEntries[i].getBoundingClientRect().bottom-s+o;this.activeIndicator?.setAttribute("style",`top: ${n}px; height: ${r-n}px`)}return!0};scrollToActiveHeading=()=>{if(this.anchorNavTarget||!this.tocEl)return;const t=this.prevActiveMin,e=this.prevActiveMax;if(t<0||e<0||t>e)return;const i=this.tocEntries[t],s=this.tocEntries[e],o=this.tocEl.clientHeight;let n;s.getBoundingClientRect().bottom-i.getBoundingClientRect().top<.9*o?n=i.offsetTop-32:n=s.offsetTop-o*.8,this.tocEl.scrollTo({top:n,left:0,behavior:"smooth"})};update=()=>{this.updatePending||(this.updatePending=!0,requestAnimationFrame(()=>{this.updatePending=!1,this.toggleActiveHeading()&&this.scrollToActiveHeading()}))};fallback=()=>{if(this.sections.length)for(let t=0;t<this.sections.length;t++){const e=this.sections[t].getBoundingClientRect();if(this.isInRange(e.top,0,window.innerHeight)||this.isInRange(e.bottom,0,window.innerHeight)||e.top<0&&e.bottom>window.innerHeight)this.markActiveHeading(t);else if(e.top>window.innerHeight)break}};markActiveHeading=t=>{this.active[t]=!0};fastScrollTo=t=>{cancelAnimationFrame(this.scrollAnimationId);const e=t.getBoundingClientRect().top;if(Math.abs(e)<4)return;const i=250,s=performance.now(),o=document.querySelector("body"),n=o&&window.OverlayScrollbars?.(o),r=n?n.elements().viewport:document.documentElement,l=r.scrollTop;document.documentElement.style.scrollBehavior="auto";const c=h=>{const d=h-s,a=Math.min(d/i,1),v=1-Math.pow(1-a,3);r.scrollTop=l+e*v,a<1?this.scrollAnimationId=requestAnimationFrame(c):document.documentElement.style.removeProperty("scroll-behavior")};this.scrollAnimationId=requestAnimationFrame(c)};handleAnchorClick=t=>{const e=t.composedPath().find(i=>i instanceof HTMLAnchorElement);if(e){const i=decodeURIComponent(e.hash?.substring(1)),s=this.headingIdxMap.get(i);if(s!==void 0){t.preventDefault(),this.anchorNavTarget=this.headings[s],this.scrollCorrectionTimers.forEach(clearTimeout),this.scrollCorrectionTimers=[],this.resizeObserver?.disconnect(),this.resizeObserver=null;const o=this.headings[s];if(o){const n=document.querySelector(".custom-md");n&&n.classList.add("cv-force-visible"),this.fastScrollTo(o);const r=()=>{Math.abs(o.getBoundingClientRect().top)>2&&o.scrollIntoView({behavior:"instant",block:"start"})},l=document.querySelectorAll(".expressive-code, .katex-display");this.resizeObserver=new ResizeObserver(()=>r()),l.forEach(c=>this.resizeObserver.observe(c)),this.scrollCorrectionTimers.push(setTimeout(r,800),setTimeout(r,1500),setTimeout(()=>{this.resizeObserver?.disconnect(),this.resizeObserver=null,n&&n.classList.remove("cv-force-visible")},1e4))}}}};isInRange(t,e,i){return e<t&&t<i}connectedCallback(){const t=document.getElementById("content-wrapper");if(t){const e=()=>{this.tocEl||this.init()};t.addEventListener("animationend",e,{once:!0}),setTimeout(e,500)}else this.init()}setupObserver(){this.observer.disconnect();const t=document.querySelector("body"),e=t?window.OverlayScrollbars?.(t):null;this.observer=new IntersectionObserver(this.markVisibleSection,{threshold:0,root:e?e.elements().viewport:null}),this.sections.forEach(i=>{i&&this.observer.observe(i)})}init(){if(this.tocEl=document.getElementById("toc-inner-wrapper"),!this.tocEl||(this.tocEl.addEventListener("click",this.handleAnchorClick,{capture:!0}),this.activeIndicator=document.getElementById("active-indicator"),this.tocEntries=Array.from(document.querySelectorAll("#toc a[href^='#']")),this.tocEntries.length===0))return;this.sections=new Array(this.tocEntries.length),this.headings=new Array(this.tocEntries.length);for(let i=0;i<this.tocEntries.length;i++){const s=decodeURIComponent(this.tocEntries[i].hash?.substring(1)),o=document.getElementById(s),n=o?.parentElement;o instanceof HTMLElement&&n instanceof HTMLElement&&(this.headings[i]=o,this.sections[i]=n,this.headingIdxMap.set(s,i))}this.active=new Array(this.tocEntries.length).fill(!1),this.setupObserver();const t=document.querySelector("body");t&&window.OverlayScrollbars?.(t)||setTimeout(()=>{this.setupObserver(),this.fallback(),this.update()},700),this.fallback(),this.update()}disconnectedCallback(){this.sections.forEach(t=>this.observer.unobserve(t)),this.observer.disconnect(),this.tocEl?.removeEventListener("click",this.handleAnchorClick)}}customElements.get("table-of-contents")||customElements.define("table-of-contents",u);
