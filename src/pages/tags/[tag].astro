---
import ArchivePanel from "@components/ArchivePanel.svelte";
import I18nKey from "@i18n/i18nKey";
import { i18n } from "@i18n/translation";
import MainGridLayout from "@layouts/MainGridLayout.astro";
import { getSortedPostsList } from "@utils/content-utils";
import { getTagName } from "@utils/url-utils";

export async function getStaticPaths() {
	const posts = await getSortedPostsList();
	const allTags = new Set<string>();
	posts.forEach((post) => {
		post.data.tags.forEach((tag) => {
			allTags.add(tag);
		});
	});

	return Array.from(allTags).map((tag) => {
		return {
			params: { tag },
		};
	});
}

const { tag } = Astro.params as { tag: string };

const posts = await getSortedPostsList();
const filteredPosts = posts.filter((p) => p.data.tags.includes(tag));
const tagName = getTagName(tag);
---

<MainGridLayout title={`${i18n(I18nKey.archive)} - ${tagName}`}>
    <ArchivePanel sortedPosts={filteredPosts} client:only="svelte"></ArchivePanel>
</MainGridLayout>
